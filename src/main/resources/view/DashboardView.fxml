<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.chart.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<VBox xmlns:fx="http://javafx.com/fxml"
      fx:controller="com.smartattendance.controller.DashboardController"
      spacing="16"
      style="-fx-padding: 16;"
      styleClass="dashboard"
      stylesheets="@styles/dashboard.css">

    <!-- FILTERS (2 rows) -->
    <VBox spacing="6" styleClass="filters">
        <!-- row 1 -->
        <HBox spacing="10" alignment="CENTER_LEFT">
            <Label text="From"/>
            <DatePicker fx:id="fromDate"/>

            <Label text="To"/>
            <DatePicker fx:id="toDate"/>

            <Label text="Course"/>
            <ComboBox fx:id="courseCombo" prefWidth="150"/>

            <Label text="Session"/>
            <ComboBox fx:id="sessionCombo" prefWidth="180"/>

            <Pane HBox.hgrow="ALWAYS"/>

            <HBox spacing="8">
                <Button fx:id="latestSessionBtn" text="Latest"/>
                <Button fx:id="resetBtn" text="Reset"/>
            </HBox>
        </HBox>

        <!-- row 2 -->
        <HBox spacing="10" alignment="CENTER_LEFT">
            <Label text="Show"/>
            <CheckBox fx:id="onTimeChk"  text="Present" selected="true"/>
            <CheckBox fx:id="lateChk"    text="Late"    selected="true"/>
            <CheckBox fx:id="absentChk"  text="Absent"  selected="true"/>
            <CheckBox fx:id="excusedChk" text="Pending" selected="true"/>
        </HBox>
    </VBox>

    <!-- METRIC CARDS -->
    <HBox spacing="16" alignment="CENTER">
        <StackPane styleClass="card" prefWidth="220" minWidth="180" maxWidth="320" prefHeight="90">
            <VBox spacing="2">
                <Label text="Students" styleClass="card-title"/>
                <Label fx:id="studentsCount" styleClass="card-metric"/>
            </VBox>
        </StackPane>

        <StackPane styleClass="card" prefWidth="220" minWidth="180" maxWidth="320" prefHeight="90">
            <VBox spacing="2">
                <Label text="Sessions" styleClass="card-title"/>
                <Label fx:id="sessionsCount" styleClass="card-metric"/>
            </VBox>
        </StackPane>

        <StackPane styleClass="card" prefWidth="220" minWidth="180" maxWidth="320" prefHeight="90">
            <VBox spacing="2">
                <Label text="Present Today" styleClass="card-title"/>
                <Label fx:id="presentTodayCount" styleClass="card-metric"/>
            </VBox>
        </StackPane>
    </HBox>

    <!-- ROW 1: weekly + recent -->
    <HBox spacing="10" alignment="CENTER">
        <!-- weekly -->
        <VBox HBox.hgrow="ALWAYS" maxWidth="Infinity">
            <Label text="Attendance (This Week)" styleClass="section-title"/>
            <StackPane styleClass="card" prefHeight="210" maxHeight="210" minHeight="210">
                <VBox spacing="8" style="-fx-padding: 10 10 10 10;">
                    <HBox alignment="CENTER_RIGHT" spacing="6">
                        <Pane HBox.hgrow="ALWAYS"/>
                        <Button text="ðŸ“·"  onAction="#exportWeeklyPng" styleClass="chart-tool"/>
                        <Button text="ðŸ”"  onAction="#zoomWeekly"     styleClass="chart-tool"/>
                    </HBox>
                    <BarChart fx:id="weeklyChart"
                              prefHeight="150"
                              maxHeight="150"
                              legendVisible="false">
                        <xAxis><CategoryAxis fx:id="chartXAxis"/></xAxis>
                        <yAxis><NumberAxis fx:id="chartYAxis"/></yAxis>
                    </BarChart>
                </VBox>
            </StackPane>
        </VBox>

        <!-- recent -->
        <VBox HBox.hgrow="ALWAYS" maxWidth="Infinity">
            <Label text="Recent Activity" styleClass="section-title"/>
            <StackPane styleClass="card" prefHeight="210" maxHeight="210" minHeight="210">
                <VBox spacing="8" style="-fx-padding: 10 10 10 10;">
                    <TableView fx:id="recentTable"
                               prefHeight="160"
                               maxHeight="160">
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                        </columnResizePolicy>
                        <columns>
                            <TableColumn fx:id="colTime"    text="Time"    prefWidth="130"/>
                            <TableColumn fx:id="colStudent" text="Student" prefWidth="170"/>
                            <TableColumn fx:id="colStatus"  text="Status"  prefWidth="90"/>
                        </columns>
                    </TableView>
                </VBox>
            </StackPane>
        </VBox>
    </HBox>

    <!-- ROW 2: 3 charts -->
    <HBox spacing="10" alignment="CENTER">
        <!-- Arrival histogram -->
        <VBox HBox.hgrow="ALWAYS" maxWidth="Infinity" minWidth="240">
            <Label text="Arrival Time Distribution" styleClass="section-title"/>
            <StackPane styleClass="card" prefHeight="240" maxHeight="240" minHeight="240">
                <VBox spacing="8" style="-fx-padding: 10 10 10 10;">
                    <HBox alignment="CENTER_RIGHT" spacing="6">
                        <Pane HBox.hgrow="ALWAYS"/>
                        <Button text="ðŸ“·" onAction="#exportArrivalPng" styleClass="chart-tool"/>
                        <Button text="ðŸ”" onAction="#zoomArrival"     styleClass="chart-tool"/>
                    </HBox>
                    <BarChart fx:id="arrivalHistogram"
                              prefHeight="180"
                              maxHeight="180"
                              legendVisible="false">
                        <xAxis><CategoryAxis fx:id="arrivalXAxis"/></xAxis>
                        <yAxis><NumberAxis fx:id="arrivalYAxis"/></yAxis>
                    </BarChart>
                </VBox>
            </StackPane>
        </VBox>

        <!-- Todayâ€™s Status Split -->
        <VBox HBox.hgrow="ALWAYS" maxWidth="Infinity" minWidth="240">
            <Label text="Todayâ€™s Status Split" styleClass="section-title"/>
            <StackPane styleClass="card" prefHeight="240" maxHeight="240" minHeight="240">
                <VBox spacing="6" style="-fx-padding: 10 10 10 10;">
                    <HBox alignment="CENTER_RIGHT" spacing="6">
                        <Pane HBox.hgrow="ALWAYS"/>
                        <Button text="ðŸ“·" onAction="#exportStatusPng" styleClass="chart-tool"/>
                        <Button text="ðŸ”" onAction="#zoomPie"        styleClass="chart-tool"/>
                    </HBox>
                    <HBox fx:id="statusLegendBox"
                          spacing="10"
                          alignment="CENTER_LEFT"/>
                    <PieChart fx:id="statusPie"
                              prefHeight="150"
                              maxHeight="150"
                              legendVisible="false"
                              style="-fx-padding: 4 0 0 0;"/>
                </VBox>
            </StackPane>
        </VBox>

        <!-- Attendance by Course -->
        <VBox HBox.hgrow="ALWAYS" maxWidth="Infinity" minWidth="240">
            <Label text="Attendance by Course" styleClass="section-title"/>
            <StackPane styleClass="card" prefHeight="240" maxHeight="240" minHeight="240">
                <VBox spacing="6" style="-fx-padding: 10 10 10 10;">
                    <HBox alignment="CENTER_RIGHT" spacing="6">
                        <Pane HBox.hgrow="ALWAYS"/>
                        <Button text="ðŸ“·" onAction="#exportCoursePng" styleClass="chart-tool"/>
                        <Button text="ðŸ”" onAction="#zoomCourse"     styleClass="chart-tool"/>
                    </HBox>
                    <HBox fx:id="courseLegendBox"
                          spacing="10"
                          alignment="CENTER_LEFT"/>
                    <StackedBarChart fx:id="courseChart"
                                     prefHeight="150"
                                     maxHeight="150"
                                     legendVisible="false"
                                     style="-fx-padding: 0 0 0 0;">
                        <xAxis><CategoryAxis fx:id="courseXAxis"/></xAxis>
                        <yAxis><NumberAxis fx:id="courseYAxis"/></yAxis>
                    </StackedBarChart>
                </VBox>
            </StackPane>
        </VBox>
    </HBox>

</VBox>
